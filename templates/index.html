<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GreenSphere ¬∑ ÊØèÊó•ÁªøËâ≤Ë°åÂä®ÊâìÂç°ÔΩúLeafPass & G-Points</title>
    <meta name="description" content="GreenSphere ÊòØ‰∏Ä‰∏™ÈÄöËøáÊØèÊó•Â∞è‰ªªÂä°„ÄÅÁßØÂàÜÂíåÊï∞Â≠óÂæΩÁ´†ÔºåÂ∏ÆÂä©‰Ω†ÂÖªÊàêÂèØÊåÅÁª≠ÁîüÊ¥ª‰π†ÊÉØÁöÑÂπ≥Âè∞„ÄÇ‰∏çÁÇíÂ∏Å„ÄÅ‰∏çÁêÜË¥¢ÔºåÂè™ËÆ∞ÂΩïÂíåÂ•ñÂä±ÁúüÂÆûÁöÑÁªøËâ≤Ë°åÂä®„ÄÇ">
    <meta name="keywords" content="GreenSphere, ÁªøËâ≤ÊâìÂç°, ‰ΩéÁ¢≥ÁîüÊ¥ª, ESG, ÂèØÊåÅÁª≠, ÁéØ‰øù, LeafPass, G-Points, ÁªøËâ≤ÁßØÂàÜ, Á¢≥ÂáèÊéí, ‰∏úÂçó‰∫ö, Green Impact">
    <meta name="author" content="GreenSphere">
    <meta name="robots" content="noindex,nofollow">
    <!-- ÁßªÂä®Á´Ø -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph / Social ÂàÜ‰∫´ -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="GreenSphere ¬∑ ÊØèÊó•ÁªøËâ≤Ë°åÂä®ÊâìÂç°">
    <meta property="og:description" content="Áî®Âá†ÂàÜÈíüÁöÑÂ∞èË°åÂä®ÔºåÁßØÁ¥ØÁúüÂÆûÁöÑÁªøËâ≤ÂΩ±ÂìçÂäõ„ÄÇLeafPass ÂæΩÁ´† & G-Points ÁßØÂàÜÔºåËÆ∞ÂΩï‰Ω†ÁöÑÊØè‰∏ÄÊ¨°ÁéØ‰øùÈÄâÊã©„ÄÇ">
    <meta property="og:url" content="https://greensphere.world">
    <meta property="og:site_name" content="GreenSphere">
    <meta property="og:image" content="https://greensphere.world/static/og-greensphere.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GreenSphere ¬∑ ÊØèÊó•ÁªøËâ≤Ë°åÂä®ÊâìÂç°">
    <meta name="twitter:description" content="Â∏ÆÂä©‰Ω†ÂÖªÊàê‰ΩéË¥üÊãÖ„ÄÅÂèØÊåÅÁª≠ÁöÑÁªøËâ≤ÁîüÊ¥ª‰π†ÊÉØ„ÄÇ">
    <meta name="twitter:image" content="https://greensphere.world/static/og-greensphere.png">

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/style.css?v={{ asset_version }}">

</head>

<body>
    <div class="app-shell">
        <div class="topbar">
            <div class="logo-circle"></div>
            <div>
                <div class="app-title">GreenSphere</div>
                <div class="app-subtitle" data-i18n="top.subtitle">Small actions. Real impact.</div>

            </div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.user.title">Current user</div>
            <div id="user"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.progress.title">My progress</div>
            <div class="section-desc" data-i18n="section.progress.desc">Your green journey in GreenSphere.</div>
            <div id="stats"></div>
            <div class="gs-actions" style="margin-top:10px;">
                <button id="shareBtn" class="gs-mini-btn gs-mini-btn-primary" data-i18n="btn.share">Share LeafPass</button>
                <button id="exportBtn" class="gs-mini-btn" data-i18n="btn.export">Export CSV</button>
            </div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.tasks.title">Today‚Äôs tasks</div>
            <div class="section-desc" data-i18n="section.tasks.desc">Tap what you‚Äôve done. We‚Äôll remember it with you.</div>
            <input id="taskSearch" class="gs-input gs-input-mini" placeholder="Search..." style="margin: 8px 0 6px;">
            <div id="tasks"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.challenges.title">Challenges</div>
            <div class="section-desc" data-i18n="section.challenges.desc">Join a themed challenge and climb the leaderboard.</div>
            <div id="challenges"></div>
            <div id="leaderboard"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.redeem.title">Redeem</div>
            <div class="section-desc" data-i18n="section.redeem.desc">Use points to request rewards.</div>
            <div id="rewards"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.feed.title">Feed</div>
            <div class="section-desc" data-i18n="section.feed.desc">See what others are doing and cheer them on.</div>
            <div id="feed"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.rewards.title">Next reward</div>
            <div class="section-desc" data-i18n="section.rewards.desc">Keep going. You‚Äôre close to the next milestone.</div>
            <div id="nextReward"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.history.title">Recent check-ins</div>
            <div class="section-desc" data-i18n="section.history.desc">Your latest actions, saved as a record.</div>
            <div id="history"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.badges.title">LeafPass badges</div>
            <div class="section-desc" data-i18n="section.badges.desc">Keep going and unlock your next badge.</div>
            <div id="badges"></div>
        </div>

        <div class="card">
            <div class="section-title" data-i18n="section.roadmap.title">Roadmap</div>
            <div class="section-desc" data-i18n="section.roadmap.desc">What we‚Äôre building next.</div>
            <ul class="roadmap-list">
                <li data-i18n="roadmap.item1">Streak & next-reward progress</li>
                <li data-i18n="roadmap.item2">Action history export (‰∏™‰∫∫/Âõ¢Èòü)</li>
                <li data-i18n="roadmap.item3">Company carbon ledger: emissions & offsets</li>
                <li data-i18n="roadmap.item4">Partner quests for factories & communities</li>
            </ul>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
    let USER_ID = null;
    let TG_INIT_DATA = null;
    let LOCALE = "en";

    const I18N = {
        en: {
            "top.subtitle": "Small actions. Real impact.",
            "section.user.title": "Current user",
            "section.progress.title": "My progress",
            "section.progress.desc": "Your green journey in GreenSphere.",
            "section.tasks.title": "Today‚Äôs tasks",
            "section.tasks.desc": "Tap what you‚Äôve done. We‚Äôll remember it with you.",
            "section.challenges.title": "Challenges",
            "section.challenges.desc": "Join a themed challenge and climb the leaderboard.",
            "section.redeem.title": "Redeem",
            "section.redeem.desc": "Use points to request rewards.",
            "section.feed.title": "Feed",
            "section.feed.desc": "See what others are doing and cheer them on.",
            "section.rewards.title": "Next reward",
            "section.rewards.desc": "Keep going. You‚Äôre close to the next milestone.",
            "section.history.title": "Recent check-ins",
            "section.history.desc": "Your latest actions, saved as a record.",
            "section.badges.title": "LeafPass badges",
            "section.badges.desc": "Keep going and unlock your next badge.",
            "section.roadmap.title": "Roadmap",
            "section.roadmap.desc": "What we‚Äôre building next.",
            "roadmap.item1": "Streak & next-reward progress",
            "roadmap.item2": "Action history export (personal/teams)",
            "roadmap.item3": "Company carbon ledger: emissions & offsets",
            "roadmap.item4": "Partner quests for factories & communities",
            "user.current": "Current user: {name}",
            "user.local": "Current user: {name} (local debug mode)",
            "stats.today": "Today: {done} / {total} actions completed",
            "stats.total": "Total: {points} points | Streak: {streak} days",
            "stats.allDone": "üéâ You‚Äôve completed all tasks today!",
            "badges.empty": "Complete tasks to unlock your LeafPass badges.",
            "history.empty": "No check-ins yet. Start with one task today.",
            "rewards.done": "You‚Äôve unlocked all current rewards.",
            "rewards.streak": "Streak {current} days ¬∑ {left} days to go",
            "rewards.points": "{current} points ¬∑ {left} to go",
            "rewards.actions": "{current} actions ¬∑ {left} to go",
            "rewards.generic": "{left} to go",
            "task.meta": "Earn +{points} points",
            "task.completed": "‚úÖ Completed: {title}",
            "toast.completed": "Completed: {title}",
            "btn.share": "Share LeafPass",
            "btn.export": "Export CSV",
            "error.generic": "Something went wrong. Please try again."
        },
        zh: {
            "top.subtitle": "ÊØèÂ§©Âá†ÂàÜÈíüÔºåÊç¢‰∏ÄÁÇπÁúüÂÆûÁöÑÁªøËâ≤ÊîπÂèò",
            "section.user.title": "ÂΩìÂâçÁî®Êà∑",
            "section.progress.title": "ÊàëÁöÑÁªøËâ≤ËøõÂ∫¶",
            "section.progress.desc": "ËøôÊòØ‰Ω†Âú® GreenSphere ÈáåÔºåÂ∑≤ÁªèËµ∞ËøáÁöÑÁªøËâ≤Ë∂≥Ëøπ„ÄÇ",
            "section.tasks.title": "‰ªäÂ§©ÊÉ≥ÂÆåÊàêÂì™‰∫õÂ∞èË°åÂä®Ôºü",
            "section.tasks.desc": "ÂãæÈÄâ‰Ω†Â∑≤ÁªèÂÅöËøáÁöÑ‰∫ãÊÉÖÔºåÊàë‰ª¨Ë¥üË¥£Â∏Æ‰Ω†„ÄåËÆ∞‰Ωè„ÄçËøô‰∫õÂ•Ω‰π†ÊÉØ„ÄÇ",
            "section.challenges.title": "ÊåëÊàò",
            "section.challenges.desc": "Âä†ÂÖ•ÊåëÊàòÔºåÁúãÁúãÊéíË°åÊ¶ú„ÄÇ",
            "section.redeem.title": "ÂÖëÊç¢‰∏≠ÂøÉ",
            "section.redeem.desc": "Áî®ÁßØÂàÜÊèê‰∫§ÂÖëÊç¢Áî≥ËØ∑ÔºàÂÆ°Ê†∏ÂêéÂèëÊîæÔºâ„ÄÇ",
            "section.feed.title": "Âä®ÊÄÅ",
            "section.feed.desc": "ÁúãÁúãÂ§ßÂÆ∂Âú®ÂÅö‰ªÄ‰πàÔºå‰πüÁªô‰ªñ‰∫∫ÁÇπ‰∏™Ëµû„ÄÇ",
            "section.rewards.title": "‰∏ã‰∏ÄÂ•ñÂä±",
            "section.rewards.desc": "‰Ω†Á¶ª‰∏ã‰∏ÄÊ¨°ÈáåÁ®ãÁ¢ëÂæàËøë„ÄÇ",
            "section.history.title": "ÊúÄËøëÊâìÂç°ËÆ∞ÂΩï",
            "section.history.desc": "‰Ω†ÊúÄËøëÂÆåÊàêÁöÑË°åÂä®Ôºå‰ºöË¢´ËÆ∞ÂΩï‰∏ãÊù•„ÄÇ",
            "section.badges.title": "Âè∂Â≠êÂæΩÁ´† ¬∑ LeafPass",
            "section.badges.desc": "ËøûÁª≠ÂùöÊåÅÂá†Â§©Ôºå‰Ω†ÁöÑÁ¨¨‰∏ÄÁâáÂ∞èÂè∂Â≠êÂ∞±‰ºöË¢´ÁÇπ‰∫Æ„ÄÇ",
            "section.roadmap.title": "‰∏ãÈò∂ÊÆµËßÑÂàí",
            "section.roadmap.desc": "Êé•‰∏ãÊù•Êàë‰ª¨‰ºö‰ºòÂÖàÂÅöËøô‰∫õ„ÄÇ",
            "roadmap.item1": "ËøûÁª≠ÊâìÂç°‰∏é‰∏ã‰∏ÄÂ•ñÂä±ËøõÂ∫¶",
            "roadmap.item2": "ÊâìÂç°ËÆ∞ÂΩïÂØºÂá∫Ôºà‰∏™‰∫∫/Âõ¢ÈòüÔºâ",
            "roadmap.item3": "Â∑•ÂéÇ/‰ºÅ‰∏öÁ¢≥Ë¥¶Êú¨ÔºöÊéíÊîæ‰∏é‰∏≠ÂíåÊ∂àË¥π",
            "roadmap.item4": "Â∑•ÂéÇ/Á§æÂå∫Âêà‰Ωú‰ªªÂä°ÔºàPartner questsÔºâ",
            "user.current": "ÂΩìÂâçÁî®Êà∑Ôºö{name}",
            "user.local": "ÂΩìÂâçÁî®Êà∑Ôºö{name}ÔºàÊú¨Âú∞Ë∞ÉËØïÊ®°ÂºèÔºâ",
            "stats.today": "‰ªäÂ§©‰Ω†Â∑≤ÁªèÂÆåÊàê {done} / {total} ‰∏™ÁªøËâ≤Â∞èË°åÂä®",
            "stats.total": "Á¥ØËÆ°Ëé∑Âæó {points} ÂàÜ ÔΩú Â∑≤ËøûÁª≠ÂèÇ‰∏é {streak} Â§©",
            "stats.allDone": "üéâ ‰ªäÂ§©ÁöÑÁªøËâ≤‰ªªÂä°Â∑≤ÂÖ®ÈÉ®ÂÆåÊàêÔºÅ",
            "badges.empty": "ÂùöÊåÅÂÆåÊàê‰ªªÂä°Ôºå‰Ω†‰ºöÈÄêÊ≠•Ëß£ÈîÅÂ±û‰∫é‰Ω†ÁöÑ LeafPass ÂæΩÁ´†„ÄÇ",
            "history.empty": "ËøòÊ≤°ÊúâÊâìÂç°ËÆ∞ÂΩïÔºå‰ªé‰ªäÂ§©ÂÖàÂÆåÊàê‰∏Ä‰∏™‰ªªÂä°Âêß„ÄÇ",
            "rewards.done": "‰Ω†Â∑≤Ëß£ÈîÅÂΩìÂâçÂÖ®ÈÉ®Â•ñÂä±„ÄÇ",
            "rewards.streak": "Â∑≤ËøûÁª≠ {current} Â§© ¬∑ ÂÜçÂùöÊåÅ {left} Â§©",
            "rewards.points": "Â∑≤Á¥ØËÆ° {current} ÂàÜ ¬∑ ÂÜçËé∑Âæó {left} ÂàÜ",
            "rewards.actions": "Â∑≤ÂÆåÊàê {current} Ê¨° ¬∑ ÂÜçÂÆåÊàê {left} Ê¨°",
            "rewards.generic": "ËøòÂ∑Æ {left}",
            "task.meta": "ÂÆåÊàêÂèØËé∑Âæó +{points} ÂàÜ",
            "task.completed": "‚úÖ Â∑≤ÂÆåÊàêÔºö{title}",
            "toast.completed": "Â∑≤ÂÆåÊàêÔºö{title}",
            "btn.share": "ÂàÜ‰∫´ LeafPass",
            "btn.export": "ÂØºÂá∫ CSV",
            "error.generic": "ËØ∑Ê±ÇÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ"
        },
        th: {
            "top.subtitle": "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏£‡∏¥‡∏á",
            "section.user.title": "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
            "section.progress.title": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô",
            "section.progress.desc": "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô GreenSphere",
            "section.tasks.title": "‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ",
            "section.tasks.desc": "‡πÅ‡∏ï‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ",
            "section.badges.title": "‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç LeafPass",
            "section.badges.desc": "‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
            "user.current": "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {name}",
            "user.local": "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {name} (‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö)",
            "stats.today": "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à {done} / {total} ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à",
            "stats.total": "‡∏™‡∏∞‡∏™‡∏° {points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô | ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á {streak} ‡∏ß‡∏±‡∏ô",
            "stats.allDone": "üéâ ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!",
            "badges.empty": "‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç LeafPass ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
            "task.meta": "‡∏£‡∏±‡∏ö +{points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
            "task.completed": "‚úÖ ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß: {title}",
            "toast.completed": "‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß: {title}",
            "error.generic": "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"
        },
        vi: {
            "top.subtitle": "H√†nh ƒë·ªông nh·ªè. T√°c ƒë·ªông th·∫≠t.",
            "section.user.title": "Ng∆∞·ªùi d√πng",
            "section.progress.title": "Ti·∫øn ƒë·ªô c·ªßa t√¥i",
            "section.progress.desc": "H√†nh tr√¨nh xanh c·ªßa b·∫°n trong GreenSphere.",
            "section.tasks.title": "Nhi·ªám v·ª• h√¥m nay",
            "section.tasks.desc": "Ch·ªçn vi·ªác b·∫°n ƒë√£ l√†m. Ch√∫ng t√¥i s·∫Ω ghi nh·ªõ c√πng b·∫°n.",
            "section.badges.title": "Huy hi·ªáu LeafPass",
            "section.badges.desc": "Ti·∫øp t·ª•c ƒë·ªÉ m·ªü kh√≥a huy hi·ªáu ti·∫øp theo.",
            "user.current": "Ng∆∞·ªùi d√πng: {name}",
            "user.local": "Ng∆∞·ªùi d√πng: {name} (ch·∫ø ƒë·ªô th·ª≠ nghi·ªám)",
            "stats.today": "H√¥m nay: ƒë√£ ho√†n th√†nh {done} / {total}",
            "stats.total": "T·ªïng: {points} ƒëi·ªÉm | Chu·ªói: {streak} ng√†y",
            "stats.allDone": "üéâ B·∫°n ƒë√£ ho√†n th√†nh h·∫øt nhi·ªám v·ª• h√¥m nay!",
            "badges.empty": "Ho√†n th√†nh nhi·ªám v·ª• ƒë·ªÉ m·ªü kh√≥a huy hi·ªáu LeafPass.",
            "task.meta": "Nh·∫≠n +{points} ƒëi·ªÉm",
            "task.completed": "‚úÖ ƒê√£ l√†m: {title}",
            "toast.completed": "ƒê√£ l√†m: {title}",
            "error.generic": "C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i."
        },
        km: {
            "top.subtitle": "·ûü·ûÄ·ûò·üí·ûò·ûó·û∂·ûñ·ûè·ûº·ûÖ·üó ¬∑ ·û•·ûë·üí·ûí·û∑·ûñ·ûõ·ûñ·û∑·ûè·ûî·üí·ûö·û∂·ûÄ·ûä",
            "section.user.title": "·û¢·üí·ûì·ûÄ·ûî·üí·ûö·ûæ·ûî·üí·ûö·û∂·ûü·üã",
            "section.progress.title": "·ûú·ûå·üí·ûç·ûì·ûó·û∂·ûñ·ûö·ûî·ûü·üã·ûÅ·üí·ûâ·ûª·üÜ",
            "section.progress.desc": "·ûä·üÜ·ûé·ûæ·ûö·ûî·üÉ·ûè·ûÑ·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ·ûÄ·üí·ûì·ûª·ûÑ GreenSphere",
            "section.tasks.title": "·ûó·û∂·ûö·ûÄ·û∑·ûÖ·üí·ûÖ·ûê·üí·ûÑ·üÉ·ûì·üÅ·üá",
            "section.tasks.desc": "·ûá·üí·ûö·ûæ·ûü·û¢·üí·ûú·û∏·ûä·üÇ·ûõ·û¢·üí·ûì·ûÄ·ûî·û∂·ûì·ûí·üí·ûú·ûæ ·û†·ûæ·ûô·ûô·ûæ·ûÑ·ûì·ûπ·ûÑ·ûÄ·ûè·üã·ûè·üí·ûö·û∂",
            "section.badges.title": "ÂæΩÁ´† LeafPass",
            "section.badges.desc": "·ûî·ûì·üí·ûè·ûí·üí·ûú·ûæ ·ûä·ûæ·ûò·üí·ûî·û∏·ûä·üÑ·üá·ûü·üÑÂæΩÁ´† ·ûî·ûì·üí·ûë·û∂·ûî·üã",
            "user.current": "·û¢·üí·ûì·ûÄ·ûî·üí·ûö·ûæ·ûî·üí·ûö·û∂·ûü·üã·üñ {name}",
            "user.local": "·û¢·üí·ûì·ûÄ·ûî·üí·ûö·ûæ·ûî·üí·ûö·û∂·ûü·üã·üñ {name} (local debug mode)",
            "stats.today": "·ûê·üí·ûÑ·üÉ·ûì·üÅ·üá·üñ ·ûî·û∂·ûì·ûî·ûâ·üí·ûÖ·ûî·üã {done} / {total}",
            "stats.total": "·ûü·ûö·ûª·ûî·üñ {points} ·ûñ·û∑·ûì·üí·ûë·ûª | streak·üñ {streak} ·ûê·üí·ûÑ·üÉ",
            "stats.allDone": "üéâ ·û¢·üí·ûì·ûÄ·ûî·û∂·ûì·ûî·ûâ·üí·ûÖ·ûî·üã·ûó·û∂·ûö·ûÄ·û∑·ûÖ·üí·ûÖ·ûê·üí·ûÑ·üÉ·ûì·üÅ·üá·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã!",
            "badges.empty": "·ûî·üÜ·ûñ·üÅ·ûâ·ûó·û∂·ûö·ûÄ·û∑·ûÖ·üí·ûÖ ·ûä·ûæ·ûò·üí·ûî·û∏·ûä·üÑ·üá·ûü·üÑÂæΩÁ´† LeafPass ·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ",
            "task.meta": "·ûë·ûë·ûΩ·ûõ +{points} ·ûñ·û∑·ûì·üí·ûë·ûª",
            "task.completed": "‚úÖ ·ûî·û∂·ûì·ûí·üí·ûú·ûæ·üñ {title}",
            "toast.completed": "·ûî·û∂·ûì·ûí·üí·ûú·ûæ·üñ {title}",
            "error.generic": "·ûò·û∂·ûì·ûî·ûâ·üí·û†·û∂ ·ûü·ûº·ûò·ûñ·üí·ûô·û∂·ûô·û∂·ûò·ûò·üí·ûè·ûÑ·ûë·üÄ·ûè"
        }
    };

    function normalizeLang(code) {
        const v = (code || '').toLowerCase();
        if (v.startsWith('zh')) return 'zh';
        if (v.startsWith('th')) return 'th';
        if (v.startsWith('vi')) return 'vi';
        if (v.startsWith('km') || v.startsWith('kh')) return 'km';
        return 'en';
    }

    function tr(key, params) {
        const dict = I18N[LOCALE] || I18N.en;
        let s = (dict && dict[key]) || I18N.en[key] || '';
        if (!s) return '';
        if (params) {
            Object.keys(params).forEach(k => {
                s = s.replaceAll('{' + k + '}', String(params[k]));
            });
        }
        return s;
    }

    function applyTranslations() {
        const dict = I18N[LOCALE] || I18N.en;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const value = (dict && dict[key]) || I18N.en[key];
            if (value) el.textContent = value;
        });
        document.documentElement.lang = LOCALE === 'zh' ? 'zh-CN' : LOCALE;
    }

    function showToast(text) {
        const t = document.getElementById('toast');
        t.innerText = text;
        t.classList.add('show');
        setTimeout(() => {
            t.classList.remove('show');
        }, 2200);
    }

    function escapeHtml(s) {
        return String(s || '')
            .replaceAll('&', '&amp;')
            .replaceAll('<', '&lt;')
            .replaceAll('>', '&gt;')
            .replaceAll('"', '&quot;')
            .replaceAll("'", '&#39;');
    }

    function setErrorState(message) {
        const msg = message || tr('error.generic');
        showToast(msg);
        const statsDiv = document.getElementById('stats');
        const tasksDiv = document.getElementById('tasks');
        const badgesDiv = document.getElementById('badges');
        if (statsDiv) statsDiv.innerHTML = `<div class="error-box">${escapeHtml(msg)}</div>`;
        if (tasksDiv) tasksDiv.innerHTML = `<div class="error-box">${escapeHtml(msg)}</div>`;
        if (badgesDiv) badgesDiv.innerHTML = `<div class="error-box">${escapeHtml(msg)}</div>`;
        const hist = document.getElementById('history');
        const next = document.getElementById('nextReward');
        if (hist) hist.innerHTML = '';
        if (next) next.innerHTML = '';
    }

    async function apiJson(url, opts) {
        const r = await fetch(url, opts || {});
        let data = null;
        const ct = (r.headers.get('content-type') || '').toLowerCase();
        if (ct.includes('application/json')) {
            try { data = await r.json(); } catch (e) {}
        } else {
            try { data = await r.text(); } catch (e) {}
        }
        if (!r.ok) {
            const detail = (data && data.detail) ? data.detail : (typeof data === 'string' ? data : '');
            throw new Error(`HTTP ${r.status}${detail ? (': ' + detail) : ''}`);
        }
        return data;
    }

    async function initUser() {
        const tg = window.Telegram && window.Telegram.WebApp;
        let telegramId = null;
        let username = null;

        if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
            TG_INIT_DATA = tg.initData || null;
            LOCALE = normalizeLang(tg.initDataUnsafe.user.language_code || navigator.language);
            applyTranslations();
            const u = tg.initDataUnsafe.user;
            telegramId = u.id;
            username = u.username || (u.first_name || '') + ' ' + (u.last_name || '');
            document.getElementById('user').innerText = tr('user.current', {
                name: (username || ('TG User ' + telegramId))
            });
        } else {
            LOCALE = normalizeLang(navigator.language);
            applyTranslations();
            telegramId = 1;
            username = 'Local Demo User';
            document.getElementById('user').innerText = tr('user.local', {name: username});
        }

        const data = await apiJson('/api/init_user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-GS-Lang': LOCALE,
                ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
            },
            body: JSON.stringify({ telegram_id: telegramId, username: username })
        });
        USER_ID = data.user_id;
    }

    const QUEUE_KEY = 'greensphere_offline_queue_v1';

    function getQueue() {
        try {
            const raw = localStorage.getItem(QUEUE_KEY) || '[]';
            const arr = JSON.parse(raw);
            return Array.isArray(arr) ? arr : [];
        } catch (e) {
            return [];
        }
    }

    function setQueue(arr) {
        try {
            localStorage.setItem(QUEUE_KEY, JSON.stringify(arr || []));
        } catch (e) {}
    }

    async function drainQueue() {
        const q = getQueue();
        if (!q.length) return;
        const remaining = [];
        for (const item of q) {
            try {
                await apiJson('/api/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-GS-Lang': LOCALE,
                        ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                    },
                    body: JSON.stringify({user_id: USER_ID, task_id: item.task_id})
                });
            } catch (e) {
                remaining.push(item);
            }
        }
        setQueue(remaining);
    }

    async function loadData() {
        const tasksDiv = document.getElementById('tasks');
        if (tasksDiv) tasksDiv.innerHTML = '<div class="loading">Loading‚Ä¶</div>';
        if (!USER_ID) await initUser();

        const data = await apiJson('/api/tasks?user_id=' + USER_ID, {
            headers: {
                'X-GS-Lang': LOCALE,
                ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
            }
        });
        const stats = data.stats;

        const statsDiv = document.getElementById('stats');
        let html = '';
        html += '<div class="progress-kpi">' + tr('stats.total', {points: stats.total_points, streak: stats.streak}) + '</div>';
        html += '<div class="progress-sub">' + tr('stats.today', {done: stats.today_completed, total: stats.total_tasks}) + '</div>';
        if (stats.total_tasks > 0 && stats.today_completed === stats.total_tasks) {
            html += '<div class="all-done">' + tr('stats.allDone') + '</div>';
        }
        statsDiv.innerHTML = html;

        const badgesDiv = document.getElementById('badges');
        const badges = data.badges || [];
        if (badges.length === 0) {
            badgesDiv.innerHTML = '<div class="empty-muted">' + tr('badges.empty') + '</div>';
        } else {
            const items = badges
                .slice(0, 12)
                .map(b => `<span title="${(b.description || '').replace(/"/g, '&quot;')}">${b.title}</span>`)
                .join('');
            badgesDiv.innerHTML = `<div class="badges-list">${items}</div>`;
        }

        const taskSearch = document.getElementById('taskSearch');
        const keyword = (taskSearch && taskSearch.value ? taskSearch.value : '').trim().toLowerCase();
        const taskList = (data.tasks || []).filter(t => {
            if (!keyword) return true;
            return String(t.title || '').toLowerCase().includes(keyword);
        });
        tasksDiv.innerHTML = '';
        taskList.forEach(t => {
            const btn = document.createElement('button');
            btn.classList.add('task-button');
            const titleSpan = document.createElement('span');
            titleSpan.classList.add('title');
            const metaSpan = document.createElement('span');
            metaSpan.classList.add('meta');
            metaSpan.innerText = tr('task.meta', {points: t.points});

            if (t.completed_today) {
                btn.classList.add('completed');
                titleSpan.innerText = tr('task.completed', {title: t.title});
                btn.disabled = true;
            } else {
                titleSpan.innerText = t.title;
                btn.onclick = async () => {
                    try {
                        await apiJson('/api/complete', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-GS-Lang': LOCALE,
                                ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                            },
                            body: JSON.stringify({user_id: USER_ID, task_id: t.id})
                        });
                        showToast(tr('toast.completed', {title: t.title}));
                        await loadData();
                    } catch (e) {
                        const msg = e && e.message ? e.message : tr('error.generic');
                        if (!String(msg).startsWith('HTTP ')) {
                            const q = getQueue();
                            q.push({task_id: t.id, ts: Date.now()});
                            setQueue(q.slice(-50));
                            showToast('Queued');
                            await loadData();
                            return;
                        }
                        setErrorState(msg);
                    }
                };
            }

            btn.appendChild(titleSpan);
            btn.appendChild(metaSpan);
            tasksDiv.appendChild(btn);
        });

        const historyDiv = document.getElementById('history');
        if (historyDiv) {
            const logs = data.recent_logs || [];
            if (!logs.length) {
                historyDiv.innerHTML = `<div class="empty-muted">${escapeHtml(tr('history.empty'))}</div>`;
            } else {
                historyDiv.innerHTML = '<ul class="history-list">' + logs.map(x => (
                    `<li><span class="history-title">${escapeHtml(x.title || '')}</span><span class="history-meta">${escapeHtml(x.date || '')}</span></li>`
                )).join('') + '</ul>';
            }
        }

        const nextDiv = document.getElementById('nextReward');
        if (nextDiv) {
            const next = data.next_rewards || [];
            if (!next.length) {
                nextDiv.innerHTML = `<div class="empty-muted">${escapeHtml(tr('rewards.done'))}</div>`;
            } else {
                nextDiv.innerHTML = next.map(r => {
                    if (r.rule_type === 'streak') {
                        return `<div class="reward-row"><div class="reward-title">${escapeHtml(r.title)}</div><div class="reward-meta">${escapeHtml(tr('rewards.streak', {current: r.current, left: r.remaining}))}</div></div>`;
                    }
                    if (r.rule_type === 'total_points') {
                        return `<div class="reward-row"><div class="reward-title">${escapeHtml(r.title)}</div><div class="reward-meta">${escapeHtml(tr('rewards.points', {current: r.current, left: r.remaining}))}</div></div>`;
                    }
                    if (r.rule_type === 'total_completions') {
                        return `<div class="reward-row"><div class="reward-title">${escapeHtml(r.title)}</div><div class="reward-meta">${escapeHtml(tr('rewards.actions', {current: r.current, left: r.remaining}))}</div></div>`;
                    }
                    return `<div class="reward-row"><div class="reward-title">${escapeHtml(r.title)}</div><div class="reward-meta">${escapeHtml(tr('rewards.generic', {left: r.remaining}))}</div></div>`;
                }).join('');
            }
        }

        const challengesDiv = document.getElementById('challenges');
        const leaderboardDiv = document.getElementById('leaderboard');
        if (challengesDiv) {
            const list = data.challenges || [];
            if (!list.length) {
                challengesDiv.innerHTML = `<div class="empty-muted">No challenges.</div>`;
            } else {
                challengesDiv.innerHTML = list.map(ch => {
                    const btn = ch.joined
                        ? `<button class="gs-mini-btn" disabled>Joined</button>`
                        : `<button class="gs-mini-btn gs-mini-btn-primary" data-join="${ch.id}">Join</button>`;
                    return `<div class="mini-row"><div><div class="mini-title">${escapeHtml(ch.title)}</div><div class="mini-meta">${escapeHtml(ch.start_date)} ‚Üí ${escapeHtml(ch.end_date)}</div></div>${btn}</div>`;
                }).join('');
                challengesDiv.querySelectorAll('[data-join]').forEach(el => {
                    el.onclick = async () => {
                        try {
                            const id = parseInt(el.getAttribute('data-join') || '0', 10);
                            await apiJson('/api/challenges/join', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-GS-Lang': LOCALE,
                                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                                },
                                body: JSON.stringify({user_id: USER_ID, challenge_id: id})
                            });
                            showToast('Joined');
                            await loadData();
                        } catch (e) {
                            setErrorState(e && e.message ? e.message : tr('error.generic'));
                        }
                    };
                });
                const first = list[0];
                if (leaderboardDiv && first) {
                    const lb = await apiJson('/api/challenges/' + first.id + '/leaderboard?limit=20', {
                        headers: {'X-GS-Lang': LOCALE, ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})}
                    });
                    const rows = (lb && lb.rows) || [];
                    leaderboardDiv.innerHTML = rows.length
                        ? '<div class="lb-title">Leaderboard</div><ol class="lb-list">' + rows.map((r, idx) => (
                            `<li><span class="lb-rank">#${idx + 1}</span><span class="lb-name">${escapeHtml(r.name || ('User ' + r.user_id))}</span><span class="lb-score">${escapeHtml(String(r.points || 0))}</span></li>`
                        )).join('') + '</ol>'
                        : '<div class="empty-muted">No leaderboard yet.</div>';
                }
            }
        }

        const rewardsDiv = document.getElementById('rewards');
        if (rewardsDiv) {
            const items = data.rewards || [];
            if (!items.length) {
                rewardsDiv.innerHTML = `<div class="empty-muted">No rewards.</div>`;
            } else {
                rewardsDiv.innerHTML = items.map(r => {
                    return `<div class="mini-row"><div><div class="mini-title">${escapeHtml(r.title)}</div><div class="mini-meta">${escapeHtml(String(r.cost_points))} pts ¬∑ ${escapeHtml(r.description || '')}</div></div><button class="gs-mini-btn gs-mini-btn-primary" data-redeem="${r.id}">Redeem</button></div>`;
                }).join('');
                rewardsDiv.querySelectorAll('[data-redeem]').forEach(el => {
                    el.onclick = async () => {
                        try {
                            const id = parseInt(el.getAttribute('data-redeem') || '0', 10);
                            await apiJson('/api/rewards/redeem', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-GS-Lang': LOCALE,
                                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                                },
                                body: JSON.stringify({user_id: USER_ID, reward_id: id})
                            });
                            showToast('Submitted');
                            await loadData();
                        } catch (e) {
                            setErrorState(e && e.message ? e.message : tr('error.generic'));
                        }
                    };
                });
            }
        }

        const feedDiv = document.getElementById('feed');
        if (feedDiv) {
            const rows = data.feed || [];
            if (!rows.length) {
                feedDiv.innerHTML = `<div class="empty-muted">No activity yet.</div>`;
            } else {
                feedDiv.innerHTML = rows.map(x => {
                    return `<div class="feed-item"><div class="feed-top"><div class="feed-name">${escapeHtml(x.name || ('User ' + x.user_id))}</div><div class="feed-time">${escapeHtml((x.created_at || '').slice(0, 19))}</div></div><div class="feed-msg">${escapeHtml(x.message)}</div><div class="feed-actions"><button class="gs-mini-btn" data-like="${x.id}">üëç ${escapeHtml(String(x.like_count || 0))}</button><button class="gs-mini-btn" data-comment="${x.id}">üí¨ ${escapeHtml(String(x.comment_count || 0))}</button></div><div class="feed-commentbox" id="c${x.id}" style="display:none;"><input class="gs-input gs-input-mini" placeholder="Comment..." /><button class="gs-mini-btn gs-mini-btn-primary" data-send="${x.id}">Send</button></div></div>`;
                }).join('');
                feedDiv.querySelectorAll('[data-like]').forEach(el => {
                    el.onclick = async () => {
                        try {
                            const id = parseInt(el.getAttribute('data-like') || '0', 10);
                            await apiJson('/api/feed/like', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-GS-Lang': LOCALE,
                                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                                },
                                body: JSON.stringify({user_id: USER_ID, feed_id: id})
                            });
                            await loadData();
                        } catch (e) {
                            setErrorState(e && e.message ? e.message : tr('error.generic'));
                        }
                    };
                });
                feedDiv.querySelectorAll('[data-comment]').forEach(el => {
                    el.onclick = () => {
                        const id = el.getAttribute('data-comment');
                        const box = document.getElementById('c' + id);
                        if (box) box.style.display = box.style.display === 'none' ? 'flex' : 'none';
                    };
                });
                feedDiv.querySelectorAll('[data-send]').forEach(el => {
                    el.onclick = async () => {
                        try {
                            const id = parseInt(el.getAttribute('data-send') || '0', 10);
                            const box = document.getElementById('c' + id);
                            const input = box ? box.querySelector('input') : null;
                            const text = input ? (input.value || '').trim() : '';
                            if (!text) return;
                            await apiJson('/api/feed/comment', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-GS-Lang': LOCALE,
                                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                                },
                                body: JSON.stringify({user_id: USER_ID, feed_id: id, text})
                            });
                            await loadData();
                        } catch (e) {
                            setErrorState(e && e.message ? e.message : tr('error.generic'));
                        }
                    };
                });
            }
        }
    }

    (async () => {
        try {
            await initUser();
            await drainQueue();
            await loadData();
        } catch (e) {
            setErrorState(e && e.message ? e.message : tr('error.generic'));
        }
    })();

    document.getElementById('taskSearch').addEventListener('input', () => {
        loadData().catch(() => {});
    });

    document.getElementById('shareBtn').onclick = async () => {
        try {
            const r = await apiJson('/api/profile/share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-GS-Lang': LOCALE,
                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                },
                body: JSON.stringify({user_id: USER_ID, is_public: true})
            });
            const url = r && r.url ? r.url : '';
            if (url) {
                try { await navigator.clipboard.writeText(url); } catch (e) {}
                showToast('Copied');
            } else {
                showToast('OK');
            }
        } catch (e) {
            setErrorState(e && e.message ? e.message : tr('error.generic'));
        }
    };

    document.getElementById('exportBtn').onclick = async () => {
        try {
            const r = await fetch('/api/export/logs.csv?user_id=' + USER_ID, {
                headers: {
                    'X-GS-Lang': LOCALE,
                    ...(TG_INIT_DATA ? {'X-Telegram-Init-Data': TG_INIT_DATA} : {})
                }
            });
            if (!r.ok) throw new Error('HTTP ' + r.status);
            const blob = await r.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'greensphere_logs.csv';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            showToast('Downloaded');
        } catch (e) {
            setErrorState(e && e.message ? e.message : tr('error.generic'));
        }
    };
    </script>
</body>
</html>

<!--
  GreenSphere Telegram WebApp
  ÁªìÊûÑÔºö
    - app-shell/topbarÔºöÂìÅÁâåÂå∫
    - card(ÂΩìÂâçÁî®Êà∑ / ËøõÂ∫¶ / ‰ªäÊó•‰ªªÂä° / ÊàëÁöÑÂæΩÁ´†)
  Ê†∑ÂºèÂÖ•Âè£Ôºö/static/style.css
-->

